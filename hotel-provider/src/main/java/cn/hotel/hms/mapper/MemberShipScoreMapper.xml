<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.hotel.hms.mapper.MemberShipScoreMapper">
    <select id="queryAllMemberShipScore" resultType="cn.hotel.vo.MemberShipScoreVO">
         SELECT mssId, mssMId, mssIntegral, mssStatus,
         (SELECT mName FROM member WHERE `mId`=mssMId) mName,
         (SELECT mrName FROM `membershiprank` WHERE mrId = (SELECT mMemberShipRank FROM member WHERE `mId`=mssMId )) mMSR
          FROM `memberShipScore` WHERE mssIntegral >=100 AND mssStatus = 1
    </select>

    <update id="updateMemberShipScore">
        update  memberShipScore
        <set>
            <if test="mssIntegral!=null and mssIntegral!=-1">mssIntegral = mssIntegral-#{mssIntegral},</if>
            <if test="mssStatus!=null and mssStatus!=-1">mssStatus = #{mssStatus}</if>
        </set>
        where mssId = #{mssId}
    </update>

    <select id="detailMemberShipScoreVO" resultType="cn.hotel.vo.MemberShipScoreVO">
          SELECT mssId, mssMId, mssIntegral, mssStatus,
         (SELECT mName FROM member WHERE `mId`=mssMId) mName,
         (SELECT mrName FROM `membershiprank` WHERE mrId = (SELECT mMemberShipRank FROM member WHERE `mId`=mssMId )) mMSR
          FROM `memberShipScore` WHERE mssIntegral >=100 AND mssStatus = 1 ORDER BY RAND() LIMIT 1
    </select>
    <select id="detailMSSV" resultType="cn.hotel.vo.MemberShipScoreVO" parameterType="integer">
          SELECT mssId, mssMId, mssIntegral, mssStatus,
         (SELECT mName FROM member WHERE `mId`=mssMId) mName,
         (SELECT mrName FROM `membershiprank` WHERE mrId = (SELECT mMemberShipRank FROM member WHERE `mId`=mssMId )) mMSR
          FROM `memberShipScore`
        where mssStatus = #{mssStatus}
    </select>
    <select id="ListdetailMSSV" resultType="cn.hotel.vo.MemberShipScoreVO" parameterType="integer">
          SELECT mssId, mssMId, mssIntegral, mssStatus,
         (SELECT mName FROM member WHERE `mId`=mssMId) mName,
         (SELECT mrName FROM `membershiprank` WHERE mrId = (SELECT mMemberShipRank FROM member WHERE `mId`=mssMId )) mMSR
          FROM `memberShipScore`
        where mssStatus = #{mssStatus}
    </select>

</mapper>